name: Renovate update dependencies
on:
  schedule:
    # UTC 10:00 AM (8PM AEST, Monday - Thursday and on Sundays)
    #- cron: '0 10 * * 0-4'
  workflow_dispatch:
    inputs:
      dry-run:
        description: 'Dry run'
        required: false
        default: true
        type: boolean

jobs:
  renovate:
    name: Self-hosted Renovate
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
      - name: Self-hosted Renovate (Server)
        uses: renovatebot/github-action@8cb0d4a6ab7d8bb90460a005f7bd33b80dd07ca8 # v44.2.5
        with:
          configurationFile: renovate-config.js
          token: ${{ secrets.RENOVATE_GITHUB_TOKEN }}
        env:
          # Running Renovate against the backend takes quite a bit of memory. Running it locally consumes ~3.1 GB.
          # Without this, Node will run out of heap space. GitHub Action runners have about 7 GB available, so this should be okay.
          # Similar issue: https://github.com/renovatebot/renovate/issues/5784
          #NODE_OPTIONS: --max-old-space-size=4096
          RENOVATE_DRY_RUN: ${{ inputs.dry-run && 'full' || null }}
